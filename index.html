<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Chor Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        .container {
            width: 90%;
            max-width: 1400px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .input-section {
            padding: 20px;
            background-color: #f9fafb;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            margin: 20px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaecef;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4a6491;
            box-shadow: 0 0 0 3px rgba(74, 100, 145, 0.2);
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        #extractBtn {
            background-color: #4a6491;
            color: white;
            padding: 20px 40px;
            font-size: 18px;
            flex: 2;
            min-width: 250px;
        }
        
        #extractBtn:hover {
            background-color: #3a547e;
            transform: translateY(-2px);
        }
        
        #saveExcelBtn, #copyBtn {
            background-color: #27ae60;
            color: white;
            flex: 1;
            min-width: 180px;
        }
        
        #saveExcelBtn:hover, #copyBtn:hover {
            background-color: #219653;
            transform: translateY(-2px);
        }
        
        #clearBtn {
            background-color: #e74c3c;
            color: white;
            flex: 1;
            min-width: 120px;
        }
        
        #clearBtn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .data-storage-section {
            width: 100%;
            padding: 20px;
            margin-top: 20px;
            background-color: #f9fafb;
            border-top: 2px solid #eaecef;
        }
        
        .data-storage-section h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .record-count {
            font-size: 16px;
            background-color: #4a6491;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #e1e1e1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }
        
        th {
            background-color: #f1f5f9;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        tr:hover {
            background-color: #e8f4fd;
        }
        
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid #eaecef;
            margin-top: 20px;
        }
        
        .duplicate-row {
            background-color: #ffe6e6 !important;
        }
        
        /* Notification area at bottom right */
        .notification-area {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }
        
        .notification {
            padding: 12px 15px;
            margin-top: 10px;
            border-radius: 6px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
            transition: opacity 0.3s;
        }
        
        .notification.success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .notification.error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .notification.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin-bottom: 10px;
            }
            
            #extractBtn {
                order: -1;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            .notification-area {
                width: 90%;
                right: 5%;
                bottom: 10px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Data Chor Tool</h1>
            <p class="description">Sathi jaagar lagayera kam gara hai lamo, 50% revenue ko sawal xa. <br>
            Tha hola ni monthly 1.5 crore.</p>
        </header>
        
        <section class="input-section">
            <h2>Input Client Details</h2>
            <textarea id="clientData" placeholder="Paste client details here..."></textarea>
            
            <div class="buttons">
                <button id="extractBtn">Extract & Add to Table</button>
                <button id="saveExcelBtn">Save All Data to Excel</button>
                <button id="copyBtn">Copy All Data</button>
                <button id="clearBtn">Clear Input</button>
            </div>
        </section>
        
        <section class="data-storage-section">
            <h2>
                Extracted Data Storage
                <span id="recordCount" class="record-count">0 Records</span>
            </h2>
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Mobile Number</th>
                            <th>Tier</th>
                            <th>Total Deposit Amount</th>
                            <th>Win/Loss</th>
                            <th>Inactive Days</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <footer>
            <p>Client Data Extraction Tool &copy; 2023 | Paste client details and extract required fields</p>
        </footer>
    </div>

    <!-- Notification Area -->
    <div class="notification-area" id="notificationArea"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const clientDataTextarea = document.getElementById('clientData');
            const extractBtn = document.getElementById('extractBtn');
            const saveExcelBtn = document.getElementById('saveExcelBtn');
            const copyBtn = document.getElementById('copyBtn');
            const clearBtn = document.getElementById('clearBtn');
            const tableBody = document.getElementById('tableBody');
            const recordCount = document.getElementById('recordCount');
            const notificationArea = document.getElementById('notificationArea');
            
            // Extract data function
            function extractData() {
                const text = clientDataTextarea.value;
                if (!text.trim()) {
                    showNotification('Please paste client details first.', 'error');
                    return;
                }
                
                const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                
                // Initialize data object
                const data = {
                    fullName: '',
                    email: '',
                    mobileNumber: '',
                    tier: '',
                    totalDepositAmount: '',
                    winLoss: '',
                    inactiveDays: ''
                };
                
                // Extract data based on patterns
                let firstName = '';
                let lastName = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // First Name - typically appears before "Firstname" label
                    if (line.toLowerCase().includes('firstname') && i > 0) {
                        firstName = lines[i-1];
                    }
                    
                    // Last Name - typically appears before "Lastname" label
                    if (line.toLowerCase().includes('lastname') && i > 0) {
                        lastName = lines[i-1];
                    }
                    
                    // Email - typically appears before "Email" label
                    if (line.toLowerCase().includes('email') && i > 0 && 
                        lines[i-1].includes('@') && lines[i-1].includes('.')) {
                        data.email = lines[i-1];
                    }
                    
                    // Mobile Number - typically appears before "Mobile Number" label
                    if (line.toLowerCase().includes('mobile number') && i > 0) {
                        // Format mobile number to prevent scientific notation
                        let mobile = lines[i-1];
                        // Remove any non-digit characters except +
                        mobile = mobile.replace(/[^\d+]/g, '');
                        data.mobileNumber = mobile;
                    }
                    
                    // Tier - typically appears before "Tier" label
                    if (line.toLowerCase().includes('tier') && i > 0) {
                        data.tier = lines[i-1];
                    }
                    
                    // Total Deposit Amount - typically appears before "Total Deposit Amount" label
                    if (line.toLowerCase().includes('total deposit amount') && i > 0) {
                        data.totalDepositAmount = lines[i-1];
                    }
                    
                    // Win/Loss - typically appears before "Lifetime Winloss" label
                    if ((line.toLowerCase().includes('lifetime winloss') || 
                         line.toLowerCase().includes('winloss')) && i > 0) {
                        data.winLoss = lines[i-1];
                    }
                    
                    // Inactive Days - typically appears before "Inactive Days" label
                    if (line.toLowerCase().includes('inactive days') && i > 0) {
                        data.inactiveDays = lines[i-1];
                    }
                }
                
                // Combine first and last name with a space
                data.fullName = (firstName + ' ' + lastName).trim();
                
                // Additional pattern matching for edge cases
                // If we didn't find first/last name with the pattern, try to extract from the first line
                if (!data.fullName && lines.length > 0) {
                    const firstLine = lines[0];
                    if (firstLine.toLowerCase().includes('details')) {
                        data.fullName = firstLine.replace('Details', '').trim();
                    }
                }
                
                // Add extracted data to table
                addDataToTable(data);
                showNotification('Data extracted and added to table successfully!', 'success');
                
                // Clear the textarea for the next entry
                clientDataTextarea.value = '';
            }
            
            // Add data to table (at the top)
            function addDataToTable(data) {
                const row = document.createElement('tr');
                row.id = 'row-' + Date.now(); // Unique ID for each row
                
                // Store the raw data in the row for duplicate checking
                row.dataset.rawData = JSON.stringify(data);
                
                // Check for duplicates before adding
                const isDuplicate = checkForDuplicate(data);
                if (isDuplicate) {
                    row.classList.add('duplicate-row');
                    showNotification('Duplicate data detected. Only the latest entry is highlighted.', 'info');
                }
                
                // Create cells for each data field
                const fields = ['fullName', 'email', 'mobileNumber', 'tier', 'totalDepositAmount', 'winLoss', 'inactiveDays'];
                
                fields.forEach(field => {
                    const cell = document.createElement('td');
                    let value = data[field] || '-';
                    cell.textContent = value;
                    cell.title = value; // Show full text on hover
                    
                    // Format mobile number for display - FIXED: Show full number
                    if (field === 'mobileNumber' && value && value !== '-') {
                        // Remove any non-digit characters except +
                        let cleaned = value.replace(/[^\d+]/g, '');
                        
                        // Format with dashes for readability but show ALL digits
                        if (cleaned.length >= 10) {
                            // Format as XXX-XXX-XXXX for the first 10 digits, then append remaining digits
                            const firstPart = cleaned.substring(0, 10).replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
                            const remaining = cleaned.substring(10);
                            cleaned = firstPart + (remaining ? remaining : '');
                        }
                        cell.textContent = cleaned;
                    }
                    
                    row.appendChild(cell);
                });
                
                // Add delete button
                const actionsCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.style.backgroundColor = '#e74c3c';
                deleteBtn.style.color = 'white';
                deleteBtn.style.padding = '5px 10px';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '3px';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.addEventListener('click', function() {
                    row.remove();
                    updateRecordCount();
                    showNotification('Record deleted successfully!', 'success');
                });
                actionsCell.appendChild(deleteBtn);
                row.appendChild(actionsCell);
                
                // Add the new row at the top of the table
                if (tableBody.firstChild) {
                    tableBody.insertBefore(row, tableBody.firstChild);
                } else {
                    tableBody.appendChild(row);
                }
                
                updateRecordCount();
            }
            
            // Check if the new data is a duplicate of existing data
            function checkForDuplicate(newData) {
                const rows = tableBody.getElementsByTagName('tr');
                
                // First, remove duplicate highlighting from all rows
                for (let i = 0; i < rows.length; i++) {
                    rows[i].classList.remove('duplicate-row');
                }
                
                // Now check if the new data is a duplicate
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    // Skip if this is the row we're about to add (it doesn't have data yet)
                    if (!row.dataset.rawData) continue;
                    
                    const existingData = JSON.parse(row.dataset.rawData);
                    
                    // Compare all fields
                    const isDuplicate = 
                        newData.fullName === existingData.fullName &&
                        newData.email === existingData.email &&
                        newData.mobileNumber === existingData.mobileNumber &&
                        newData.tier === existingData.tier &&
                        newData.totalDepositAmount === existingData.totalDepositAmount &&
                        newData.winLoss === existingData.winLoss &&
                        newData.inactiveDays === existingData.inactiveDays;
                    
                    if (isDuplicate) {
                        // Only mark the new row as duplicate (we'll add the class after this function)
                        return true;
                    }
                }
                
                return false;
            }
            
            // Update record count
            function updateRecordCount() {
                const count = tableBody.children.length;
                recordCount.textContent = count + (count === 1 ? ' Record' : ' Records');
            }
            
            // Save to Excel function
            function saveToExcel() {
                const rows = tableBody.getElementsByTagName('tr');
                if (rows.length === 0) {
                    showNotification('No data to export. Please extract data first.', 'error');
                    return;
                }
                
                let csvContent = "Full Name,Email,Mobile Number,Tier,Total Deposit Amount,Win/Loss,Inactive Days\n";
                
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName('td');
                    let rowData = [];
                    
                    // Skip the actions cell (last cell)
                    for (let j = 0; j < cells.length - 1; j++) {
                        let cellValue = cells[j].textContent || '';
                        // Handle values that might contain commas
                        if (cellValue.includes(',') || cellValue.includes('"')) {
                            cellValue = '"' + cellValue.replace(/"/g, '""') + '"';
                        }
                        rowData.push(cellValue);
                    }
                    
                    csvContent += rowData.join(',') + '\n';
                }
                
                // Create and download the file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', 'client_data.csv');
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('All data exported successfully!', 'success');
            }
            
            // Copy all data to clipboard (without headers and without duplicates)
            function copyAllData() {
                const rows = tableBody.getElementsByTagName('tr');
                if (rows.length === 0) {
                    showNotification('No data to copy. Please extract data first.', 'error');
                    return;
                }
                
                let tabSeparatedData = "";
                const uniqueRows = new Set();
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row.dataset.rawData) continue;
                    
                    const dataString = row.dataset.rawData;
                    
                    // Only add if it's not a duplicate
                    if (!uniqueRows.has(dataString)) {
                        uniqueRows.add(dataString);
                        
                        const cells = row.getElementsByTagName('td');
                        let rowData = [];
                        
                        // Skip the actions cell (last cell)
                        for (let j = 0; j < cells.length - 1; j++) {
                            let cellValue = cells[j].textContent || '';
                            rowData.push(cellValue);
                        }
                        
                        tabSeparatedData += rowData.join('\t') + '\n';
                    }
                }
                
                // Copy to clipboard
                navigator.clipboard.writeText(tabSeparatedData).then(function() {
                    showNotification('All data (without duplicates) copied to clipboard! You can paste it directly into Excel.', 'success');
                }, function(err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = tabSeparatedData;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('All data (without duplicates) copied to clipboard! You can paste it directly into Excel.', 'success');
                });
            }
            
            // Clear input function
            function clearInput() {
                clientDataTextarea.value = '';
                showNotification('Input cleared. Ready for next entry.', 'success');
            }
            
            // Show notification message in bottom right
            function showNotification(message, type) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                // Add to notification area
                notificationArea.appendChild(notification);
                
                // Auto-remove after 4 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
            
            // Event listeners
            extractBtn.addEventListener('click', extractData);
            saveExcelBtn.addEventListener('click', saveToExcel);
            copyBtn.addEventListener('click', copyAllData);
            clearBtn.addEventListener('click', clearInput);
            
            // NEW: Add Enter key functionality to textarea
            clientDataTextarea.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault(); // Prevent new line
                    extractData(); // Trigger extraction
                }
            });
        });
    </script>
</body>
</html>
